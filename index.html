<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integraci√≥n de Archivos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h2 {
            margin-top: 40px;
        }
    </style>
    <script src="script-local.js"></script>
</head>
<body>
    <h1>Integraci√≥n de Archivos en un Solo Documento</h1>

    <h2>Prueba de acceso a archivos</h2>
    <button onclick="tryFileAccess()">Intentar acceso a archivos</button>
    <script>
        function tryFileAccess() {
            try {
                var input = document.createElement('input');
                input.type = 'file';
                input.click();
                document.body.appendChild(input);
                alert('Acceso a archivos permitido!');
            } catch(e) {
                alert('Error: ' + e.message);
            }
        }
    </script>

    <h2>Prueba de Cookies en WKWebView</h2>
    <button onclick="setCookie()">Establecer Cookie</button>
    <button onclick="getCookie()">Obtener Cookie</button>
    <button onclick="deleteCookie()">Eliminar Cookie</button>
    <div id="results">Resultados aparecer√°n aqu√≠...</div>
    <script>
        const COOKIE_NAME = "testCookie";
        
        function setCookie() {
            const value = "valor_de_prueba_" + new Date().getTime();
            const expires = new Date();
            expires.setDate(expires.getDate() + 7);
            document.cookie = `${COOKIE_NAME}=${value}; expires=${expires.toUTCString()}; path=/`;
            showResult(`Cookie establecida: ${COOKIE_NAME}=${value}`);
        }
        
        function getCookie() {
            const cookies = document.cookie.split(';');
            let result = "No se encontr√≥ la cookie";
            cookies.forEach(cookie => {
                const [name, value] = cookie.trim().split('=');
                if(name === COOKIE_NAME) {
                    result = `Cookie encontrada: ${name}=${value}`;
                }
            });
            showResult(result);
        }
        
        function deleteCookie() {
            document.cookie = `${COOKIE_NAME}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
            showResult(`Cookie eliminada: ${COOKIE_NAME}`);
        }
        
        function showResult(message) {
            document.getElementById('results').innerHTML = message;
            console.log(message);
        }
    </script>

    <h2>Prueba de Content Security Policy (CSP)</h2>
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self';
        style-src 'self' 'unsafe-inline';
        img-src 'self';
    ">
    <p id="inline-script" class="fail">‚è≥ Script en l√≠nea: pendiente</p>
    <p id="external-script" class="fail">‚è≥ Script externo permitido: pendiente</p>
    <p id="img-same-origin" class="fail">‚è≥ Imagen desde mismo origen: pendiente</p>
    <p id="img-cross-origin" class="fail">‚è≥ Imagen de otro dominio: pendiente</p>
    <script>
        document.getElementById("inline-script").textContent = "üö´ Script en l√≠nea ejecutado (CSP no lo bloque√≥)";
        document.getElementById("inline-script").className = "fail";
    </script>
    <script src="script-local.js"></script>
    <img src="img/CSP.jpg" alt="logo local" style="width:60px; height:auto;" onload="document.getElementById('img-same-origin').textContent = '‚úÖ Imagen local cargada correctamente'; document.getElementById('img-same-origin').className = 'ok';" onerror="document.getElementById('img-same-origin').textContent = 'üö´ Imagen local NO cargada'; document.getElementById('img-same-origin').className = 'fail';">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/120px-React-icon.svg.png" alt="Imagen externa" onload="document.getElementById('img-cross-origin').textContent = 'üö´ Imagen externa cargada (CSP no la bloque√≥)'; document.getElementById('img-cross-origin').className = 'fail';" onerror="document.getElementById('img-cross-origin').textContent = '‚úÖ Imagen externa bloqueada por CSP'; document.getElementById('img-cross-origin').className = 'ok';">

    <h2>Pruebas con DOM</h2>
    <input type="text" id="inputTexto" placeholder="Escribe algo...">
    <button onclick="guardarEnLocalStorage()">Guardar</button>
    <p>Dato guardado: <span id="etiqueta"></span></p>
    <script>
        function guardarEnLocalStorage() {
            const inputValue = document.getElementById('inputTexto').value;
            localStorage.setItem('datoGuardado', inputValue);
            document.getElementById('etiqueta').innerText = inputValue;
        }

        function cargarDesdeLocalStorage() {
            const storedValue = localStorage.getItem('datoGuardado');
            if (storedValue) {
                document.getElementById('etiqueta').innerText = storedValue;
            }
        }
        window.onload = cargarDesdeLocalStorage;
    </script>

    <h2>Prueba de M√∫ltiples Ventanas</h2>
    <button onclick="abrirVentana()">Abrir Ventana Emergente</button>
    <script>
        let popupWindow;

        function abrirVentana() {
            popupWindow = window.open("", "popup", "width=400,height=300");
            popupWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Ventana Emergente</title>
                </head>
                <body>
                    <h1>Ventana Emergente</h1>
                    <input type="text" id="mensaje" placeholder="Escribe un mensaje">
                    <button id="enviarBtn">Enviar a Principal</button>
                </body>
                </html>
            `);

            popupWindow.onload = function () {
                const script = popupWindow.document.createElement('script');
                script.textContent = `
                    function enviarMensaje() {
                        const mensaje = document.getElementById('mensaje').value;
                        console.log('Mensaje:', mensaje);
                        console.log('Window opener:', window.opener);
                        if (window.opener && !window.opener.closed) {
                            window.opener.recibirMensaje(mensaje);
                        } else {
                            alert('No se puede comunicar con la ventana principal.');
                        }
                    }
                    document.getElementById('enviarBtn').addEventListener('click', function () {
                        console.log('Bot√≥n "Enviar a Principal" clickeado');
                        enviarMensaje();
                    });
                `;
                popupWindow.document.body.appendChild(script);
            };
        }

        function recibirMensaje(mensaje) {
            document.getElementById('mensajeRecibido').innerText = mensaje;
            console.log('Mensaje recibido en la ventana principal:', mensaje);
        }
    </script>

    <h2>Prueba de Multipesta√±as</h2>
    <a href="https://www.google.com" target="_blank">Abrir Google en nueva pesta√±a</a><br>
    <a href="https://www.github.com" target="_blank">Abrir GitHub en nueva pesta√±a</a><br>
    <button onclick="window.open('https://www.android.com')">Abrir Android.com</button>
    <button onclick="openModal()">Abrir modal/popup</button>
    <script>
        function openTab(url, name, features) {
            window.open(url, name || '_blank', features);
        }
        
        function openModal() {
            const modal = window.open('', 'modalWindow', 'width=500,height=300,modal=yes');
            modal.document.write(`
                <html>
                <head><title>Ventana Modal</title></head>
                <body>
                    <h2>Esto es una ventana modal/popup</h2>
                    <p>Deber√≠a comportarse como una pesta√±a modal.</p>
                    <button onclick="window.close()">Cerrar</button>
                </body>
                </html>
            `);
        }
    </script>
        <!-- ...existing code... -->
    
        <h2>Prueba de Geolocalizaci√≥n</h2>
        <button onclick="getLocation()">Obtener Ubicaci√≥n</button>
        <pre id="output"></pre>
        <script>
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition, showError);
                } else {
                    alert("Geolocalizaci√≥n no es soportada por este navegador.");
                }
            }
    
            function showPosition(position) {
                document.getElementById("output").innerText =
                    "Latitud: " + position.coords.latitude +
                    "\nLongitud: " + position.coords.longitude;
            }
    
            function showError(error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        alert("Permiso denegado.");
                        break;
                    case error.POSITION_UNAVAILABLE:
                        alert("Ubicaci√≥n no disponible.");
                        break;
                    case error.TIMEOUT:
                        alert("Tiempo de espera agotado.");
                        break;
                    case error.UNKNOWN_ERROR:
                        alert("Error desconocido.");
                        break;
                }
            }
        </script>
    
    <!-- ...existing code... -->
</body>
</html>